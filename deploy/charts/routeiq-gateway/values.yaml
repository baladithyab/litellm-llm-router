# =============================================================================
# RouteIQ Gateway Helm Chart Values
# =============================================================================
# Default configuration values for the RouteIQ Gateway deployment.
# Override these values using -f myvalues.yaml or --set key=value
#
# Example:
#   helm install routeiq-gateway ./deploy/charts/routeiq-gateway \
#     -f production-values.yaml \
#     --set image.tag=1.82.0
# =============================================================================

# -----------------------------------------------------------------------------
# Global settings
# -----------------------------------------------------------------------------
global:
  # Image pull secrets for private registries
  imagePullSecrets: []
  # - name: regcred

# -----------------------------------------------------------------------------
# Name overrides
# -----------------------------------------------------------------------------
# Override the chart name
nameOverride: ""
# Override the full name (release-name + chart-name)
fullnameOverride: ""

# -----------------------------------------------------------------------------
# Image configuration
# -----------------------------------------------------------------------------
image:
  repository: ghcr.io/baladithyab/litellm-llm-router
  # Tag overrides appVersion from Chart.yaml
  tag: ""
  # Digest for immutable image references (takes precedence over tag)
  # Example: sha256:abc123...
  digest: ""
  pullPolicy: IfNotPresent

# -----------------------------------------------------------------------------
# Replica and scaling configuration
# -----------------------------------------------------------------------------
replicaCount: 2

# Horizontal Pod Autoscaler (optional)
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  # Custom metrics (optional)
  # behavior:
  #   scaleDown:
  #     stabilizationWindowSeconds: 300

# Pod Disruption Budget (optional)
podDisruptionBudget:
  enabled: false
  # Minimum available pods (absolute or percentage)
  minAvailable: 1
  # maxUnavailable: 1

# -----------------------------------------------------------------------------
# Service configuration
# -----------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 80
  targetPort: 4000
  # NodePort (only used if type is NodePort)
  # nodePort: 30000
  annotations: {}
  # For internal load balancers:
  # service.beta.kubernetes.io/aws-load-balancer-internal: "true"

# -----------------------------------------------------------------------------
# Ingress configuration (optional)
# -----------------------------------------------------------------------------
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # nginx.ingress.kubernetes.io/proxy-body-size: "50m"
  hosts:
    - host: routeiq.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: routeiq-tls
  #    hosts:
  #      - routeiq.example.com
# -----------------------------------------------------------------------------
# Resource requests and limits
# -----------------------------------------------------------------------------
resources:
  requests:
    memory: "512Mi"
    cpu: "500m"
  limits:
    memory: "2Gi"
    cpu: "2000m"

# -----------------------------------------------------------------------------
# Health probes
# -----------------------------------------------------------------------------
probes:
  liveness:
    enabled: true
    path: /_health/live
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
  readiness:
    enabled: true
    path: /_health/ready
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
  startup:
    enabled: false
    path: /_health/live
    initialDelaySeconds: 0
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
    successThreshold: 1

# -----------------------------------------------------------------------------
# Pod scheduling configuration
# -----------------------------------------------------------------------------

# Node selector for pod placement
nodeSelector: {}
  # kubernetes.io/os: linux

# Tolerations for pod scheduling
tolerations: []
  # - key: "dedicated"
  #   operator: "Equal"
  #   value: "llm-gateway"
  #   effect: "NoSchedule"

# Affinity rules
affinity: {}
  # Custom affinity rules override podAntiAffinity below

# Pod anti-affinity hints for spreading across nodes/zones
podAntiAffinity:
  enabled: true
  # "soft" = preferredDuringSchedulingIgnoredDuringExecution
  # "hard" = requiredDuringSchedulingIgnoredDuringExecution
  type: soft
  topologyKey: kubernetes.io/hostname
  # Additional topology key for zone spreading (optional)
  # zoneTopologyKey: topology.kubernetes.io/zone

# Topology spread constraints (alternative to affinity)
topologySpreadConstraints: []
  # - maxSkew: 1
  #   topologyKey: topology.kubernetes.io/zone
  #   whenUnsatisfiable: ScheduleAnyway
  #   labelSelector:
  #     matchLabels:
  #       app.kubernetes.io/name: routeiq-gateway

# -----------------------------------------------------------------------------
# Security context
# -----------------------------------------------------------------------------
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

containerSecurityContext:
  runAsNonRoot: true
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  seccompProfile:
    type: RuntimeDefault

# -----------------------------------------------------------------------------
# Service account
# -----------------------------------------------------------------------------
serviceAccount:
  # Create a dedicated service account
  create: true
  # Name of the service account (defaults to fullname)
  name: ""
  # Annotations for the service account
  annotations: {}
    # For AWS IRSA:
    # eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/routeiq-gateway
    # For GKE Workload Identity:
    # iam.gke.io/gcp-service-account: routeiq@project.iam.gserviceaccount.com
  # Disable automounting service account token for security
  # Enable only if your application requires Kubernetes API access
  automountServiceAccountToken: false

# -----------------------------------------------------------------------------
# Gateway configuration (environment variables)
# -----------------------------------------------------------------------------
# These map to .env.example settings
gateway:
  # Port configuration
  port: 4000

  # Configuration file path (mounted from ConfigMap)
  configPath: /app/config/config.yaml

  # Feature flags
  features:
    mcpGatewayEnabled: false
    a2aGatewayEnabled: false
    mcpHaSyncEnabled: false
    mcpToolInvocationEnabled: false

  # Hot reload settings
  hotReload:
    enabled: true
    interval: 300  # seconds

  # Config sync from S3/GCS
  configSync:
    enabled: false
    interval: 60  # seconds
    # S3 configuration
    s3:
      bucket: ""
      key: "configs/config.yaml"
    # GCS configuration (alternative)
    gcs:
      bucket: ""
      key: "configs/config.yaml"

  # Database settings
  database:
    storeModelInDb: false
    runMigrations: false

  # OTEL/Observability settings
  otel:
    enabled: true
    serviceName: litellm-gateway
    # Exporter type: none, otlp, jaeger, zipkin
    tracesExporter: none
    metricsExporter: none
    logsExporter: none
    # OTEL Collector endpoint (when using otlp)
    endpoint: ""

  # SSRF protection
  ssrf:
    allowPrivateIps: false
    allowlistHosts: ""
    allowlistCidrs: ""

# -----------------------------------------------------------------------------
# Secrets configuration
# -----------------------------------------------------------------------------
# Secrets can be provided via:
# 1. existingSecret: Reference an existing K8s Secret
# 2. secrets: Create a new Secret with values (not recommended for production)
# 3. externalSecrets: Use External Secrets Operator (recommended for production)

secrets:
  # Name of existing secret containing credentials
  existingSecret: ""

  # Create secret from values (development only - use external secrets in production)
  create: false
  values:
    # REQUIRED: Master API key for admin access
    # Generate with: openssl rand -hex 32
    LITELLM_MASTER_KEY: ""

    # Admin API keys (comma-separated)
    ADMIN_API_KEYS: ""

    # LLM Provider API keys
    OPENAI_API_KEY: ""
    ANTHROPIC_API_KEY: ""
    AZURE_API_KEY: ""
    AZURE_API_BASE: ""
    GOOGLE_APPLICATION_CREDENTIALS: ""

    # Database credentials
    POSTGRES_PASSWORD: ""
    DATABASE_URL: ""

    # Redis credentials
    REDIS_PASSWORD: ""

# External Secrets configuration (if using External Secrets Operator)
externalSecrets:
  enabled: false
  refreshInterval: "1h"
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  # Target secret name (defaults to release-name-secrets)
  targetSecretName: ""
  # Remote references
  data: []
    # - secretKey: LITELLM_MASTER_KEY
    #   remoteRef:
    #     key: routeiq/master-key
    # - secretKey: OPENAI_API_KEY
    #   remoteRef:
    #     key: routeiq/openai-key

# -----------------------------------------------------------------------------
# ConfigMap configuration
# -----------------------------------------------------------------------------
config:
  # Gateway configuration YAML (mounted at gateway.configPath)
  # See config/config.yaml for full options
  gateway: |
    model_list:
      - model_name: gpt-4o
        litellm_params:
          model: openai/gpt-4o
      - model_name: claude-3-5-sonnet
        litellm_params:
          model: anthropic/claude-3-5-sonnet-20241022

    litellm_settings:
      drop_params: true
      set_verbose: false

    general_settings:
      master_key: env/LITELLM_MASTER_KEY

  # Additional config files (optional)
  additionalConfigs: {}
    # llm_candidates.json: |
    #   { "models": [...] }

# -----------------------------------------------------------------------------
# Additional environment variables
# -----------------------------------------------------------------------------
# Extra environment variables from values
extraEnv: []
  # - name: MY_VAR
  #   value: "my-value"

# Extra environment variables from ConfigMap/Secret
extraEnvFrom: []
  # - configMapRef:
  #     name: extra-config
  # - secretRef:
  #     name: extra-secrets

# -----------------------------------------------------------------------------
# Volumes and volume mounts
# -----------------------------------------------------------------------------
extraVolumes: []
  # - name: custom-config
  #   configMap:
  #     name: custom-gateway-config

extraVolumeMounts: []
  # - name: custom-config
  #   mountPath: /app/custom-config
  #   readOnly: true

# Required for readOnlyRootFilesystem
tmpVolume:
  enabled: true
  sizeLimit: 256Mi

# -----------------------------------------------------------------------------
# Network Policy (optional, opt-in)
# -----------------------------------------------------------------------------
# IMPORTANT: NetworkPolicy is DISABLED by default (enabled: false).
# When enabled without ingress selectors, it defaults to allow-all ingress.
# For production, configure ingress selectors to restrict traffic sources.
#
# Egress defaults to:
# - DNS resolution (to kube-dns)
# - HTTPS (443) and HTTP (80) to external IPs (excludes private ranges)
# This allows LLM API calls while blocking access to internal services.
#
# To enforce strict egress (default-deny with explicit allows), set:
#   egress.allowHttpsExternal: false
#   egress.to: [...explicit rules...]
networkPolicy:
  enabled: false
  # Ingress rules - who can access the gateway
  # When no selectors are specified, allows traffic from all sources
  ingress:
    # Allow from all namespaces with specific labels
    fromNamespaceSelector: {}
      # app.kubernetes.io/name: my-app
    # Allow from pods with specific labels
    fromPodSelector: {}
    # Allow from specific CIDRs
    fromCidrs: []
      # - 10.0.0.0/8

  # Egress rules - what the gateway can access
  egress:
    # Allow DNS resolution (required for most functionality)
    allowDns: true
    # Allow HTTPS/HTTP to external services (LLM providers)
    # This blocks access to private IP ranges (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)
    allowHttpsExternal: true
    # Additional egress rules for internal services (database, Redis, etc.)
    to: []
      # - namespaceSelector:
      #     matchLabels:
      #       name: database
      #   podSelector:
      #     matchLabels:
      #       app: postgres
      #   ports:
      #     - port: 5432

# -----------------------------------------------------------------------------
# Pod labels and annotations
# -----------------------------------------------------------------------------
podLabels: {}
  # custom-label: custom-value

podAnnotations: {}
  # prometheus.io/scrape: "true"
  # prometheus.io/port: "4000"
  # prometheus.io/path: "/metrics"

# -----------------------------------------------------------------------------
# Deployment strategy
# -----------------------------------------------------------------------------
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# -----------------------------------------------------------------------------
# Termination grace period
# -----------------------------------------------------------------------------
terminationGracePeriodSeconds: 30

# -----------------------------------------------------------------------------
# Priority class
# -----------------------------------------------------------------------------
priorityClassName: ""

# -----------------------------------------------------------------------------
# Init containers (optional)
# -----------------------------------------------------------------------------
initContainers: []
  # - name: wait-for-db
  #   image: busybox:1.36
  #   command: ['sh', '-c', 'until nc -z postgres 5432; do sleep 2; done']

# -----------------------------------------------------------------------------
# Sidecar containers (optional)
# -----------------------------------------------------------------------------
sidecars: []
  # - name: otel-collector
  #   image: otel/opentelemetry-collector:latest
  #   ports:
  #     - containerPort: 4317
