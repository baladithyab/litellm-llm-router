# LiteLLM + LLMRouter - Basic Docker Compose Setup
# For production HA setup, use docker-compose.ha.yml
#
# SECURITY: Before running, set LITELLM_MASTER_KEY in your environment:
#   export LITELLM_MASTER_KEY=$(openssl rand -hex 32)

services:
  litellm-llmrouter:
    build:
      context: .
      dockerfile: docker/Dockerfile
    image: ghcr.io/baladithyab/litellm-llm-router:latest
    container_name: litellm-llmrouter
    ports:
      - "4000:4000"
    volumes:
      - ./config:/app/config:ro
      - ./models:/app/models:ro
      - ./custom_routers:/app/custom_routers:ro
    environment:
      - LITELLM_CONFIG_PATH=/app/config/config.yaml
      # SECURITY: LITELLM_MASTER_KEY is REQUIRED - no default provided
      # Generate with: openssl rand -hex 32
      - LITELLM_MASTER_KEY=${LITELLM_MASTER_KEY:?LITELLM_MASTER_KEY environment variable is required}
      # LLM Provider API Keys
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - AZURE_API_KEY=${AZURE_API_KEY:-}
      - AZURE_API_BASE=${AZURE_API_BASE:-}
      # LLMRouter Settings
      - LLMROUTER_MODELS_PATH=/app/models
      - LLMROUTER_HOT_RELOAD=${LLMROUTER_HOT_RELOAD:-true}
      - LLMROUTER_RELOAD_INTERVAL=${LLMROUTER_RELOAD_INTERVAL:-300}
      # Gateway Features (A2A, MCP)
      - A2A_GATEWAY_ENABLED=${A2A_GATEWAY_ENABLED:-false}
      - MCP_GATEWAY_ENABLED=${MCP_GATEWAY_ENABLED:-false}
      # Config Sync & Hot Reload
      - CONFIG_HOT_RELOAD=${CONFIG_HOT_RELOAD:-false}
      - CONFIG_SYNC_ENABLED=${CONFIG_SYNC_ENABLED:-true}
      - CONFIG_SYNC_INTERVAL=${CONFIG_SYNC_INTERVAL:-60}
      # S3/GCS Config Sync (optional)
      - CONFIG_S3_BUCKET=${CONFIG_S3_BUCKET:-}
      - CONFIG_S3_KEY=${CONFIG_S3_KEY:-}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4000/_health/live"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: "1.0"
    restart: unless-stopped
    networks:
      - litellm-network

networks:
  litellm-network:
    driver: bridge
